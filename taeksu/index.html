<!DOCTYPE html>
<html>
<head>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <title>ë©”ëª¨ ì•±</title>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        function App() {
            const [memos, setMemos] = React.useState([]);
            const [title, setTitle] = React.useState("");
            const [content, setContent] = React.useState("");
            const [editingId, setEditingId] = React.useState(null); // ìˆ˜ì • ì¤‘ì¸ ë©”ëª¨ ID ì €ì¥

            // 1. ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
            const fetchMemos = () => {
                fetch('/memos')
                    .then(res => res.json())
                    .then(data => setMemos(data));
            };

            // 2. ë©”ëª¨ ì¶”ê°€
            const addMemo = () => {
                if (!title.trim()) { alert("ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”!"); return; }
                fetch(`/memos?title=${encodeURIComponent(title)}&content=${encodeURIComponent(content)}`, {
                    method: 'POST'
                }).then(res => {
                    if (res.ok) { resetInputs(); fetchMemos(); }
                });
            };

            // 3. ë©”ëª¨ ìˆ˜ì • ì‹œì‘ (ì…ë ¥ì°½ì— ë°ì´í„° ì±„ìš°ê¸°)
            const startEdit = (memo) => {
                setEditingId(memo.memo_id);
                setTitle(memo.title);
                setContent(memo.content);
            };

            // 4. ë©”ëª¨ ìˆ˜ì • ì™„ë£Œ (ì„œë²„ ì „ì†¡)
            const updateMemo = () => {
                fetch(`/memos/${editingId}?title=${encodeURIComponent(title)}&content=${encodeURIComponent(content)}`, {
                    method: 'PUT'
                }).then(res => {
                    if (res.ok) { resetInputs(); fetchMemos(); }
                });
            };

            // 5. ë©”ëª¨ ì‚­ì œ
            const deleteMemo = (id) => {
                if (confirm("ì •ë§ ì‚­ì œí• ê¹Œìš”?")) {
                    fetch(`/memos/${id}`, { method: 'DELETE' })
                        .then(res => { if (res.ok) fetchMemos(); });
                }
            };

            const resetInputs = () => {
                setEditingId(null);
                setTitle("");
                setContent("");
            };

            React.useEffect(() => { fetchMemos(); }, []);

            return (
                <div style={{ padding: "20px" }}>
                    <h1>ğŸ“ ë©”ëª¨ ì•±</h1>
                    <div style={{ marginBottom: "20px" }}>
                        <input value={title} onChange={(e) => setTitle(e.target.value)} placeholder="ì œëª©" />
                        <input value={content} onChange={(e) => setContent(e.target.value)} placeholder="ë‚´ìš©" />
                        {editingId ? (
                            <span>
                                <button onClick={updateMemo}>ìˆ˜ì • ì™„ë£Œ</button>
                                <button onClick={resetInputs}>ì·¨ì†Œ</button>
                            </span>
                        ) : (
                            <button onClick={addMemo}>ì¶”ê°€</button>
                        )}
                    </div>

                    <ul style={{ listStyle: "none", padding: 0 }}>
                        {memos.map(m => (
                            <li key={m.memo_id} style={{ borderBottom: "1px solid #ccc", padding: "10px 0" }}>
                                <strong>{m.title}</strong>: {m.content}
                                <div style={{ marginTop: "5px" }}>
                                    <button onClick={() => startEdit(m)}>ìˆ˜ì •</button>
                                    <button onClick={() => deleteMemo(m.memo_id)} style={{ color: "red" }}>ì‚­ì œ</button>
                                </div>
                            </li>
                        ))}
                    </ul>
                </div>
            );
        }

        // React 18 ìµœì‹  ë Œë”ë§ ë°©ì‹ ì ìš© (ì½˜ì†” ê²½ê³  í•´ê²°)
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>