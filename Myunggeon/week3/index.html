<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="utf-8"/> <!--ìœ ë‹ˆì½”ë“œ ë¬¸ì-->
        <meta name = "viewport" content="width=device-width, initial-scale=1"/>
        <title>ğŸ—„ï¸ë©”ëª¨ì¥</title>
        <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
        <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
        <!--Reactë¼ì´ë¸ŒëŸ¬ë¦¬: CDNì—ì„œ ë¦¬ì•¡íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜´-->
        <!--Bable: JSXë¬¸ë²•ì„ ë¸Œë¼ìš°ì €ê°€ ì´í•´í•  ìˆ˜ ìˆëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë³€í™˜í•´ì£¼ëŠ” ë„êµ¬-->

        <script type = "text/babel">
            const API_BASE = "http://127.0.0.1:8000";
            async function apiFetch(path,options = {}) {
                const res = await fetch(`${API_BASE}${path}`,{
                    headers: {"Content-Type": "application/json"},
                    ...options,

                });
                
                const data = await res.json().catch(()=>({}));

                if (!res.ok){
                    const msg = (data&&(data.detail || data.error)) ? (data.detail || data.error) : `HTTP${res.status}`;
                    throw new Error(msg);
                }
                return data;
            }

            //ë©”ì¸ ì»´í¬ë„ŒíŠ¸
            function App() {
                const[memos, setMemos] = React.useState([]);
                const[title, setTitle] = React.useState("");
                const[content, setContent] = React.useState("");
                const[loading, setLoading] = React.useState(false);

                //ë©”ëª¨ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
                async function loadMemos(){
                    try {
                        const data = await apiFetch('/memos');
                        setMemos(data);}
                        catch(err) {
                            console.error (err);
                            alert('ë¦¬ë·°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                        }
                    }

                //ì²˜ìŒ í•œë²ˆë§Œ ì‹¤í–‰
                React.useEffect(()=>{loadMemos();},[]);

                //ë©”ëª¨ ì¶”ê°€ í•¨ìˆ˜
                async function addMemo() {
                    const t = title.trim();
                    const c = content.trim();

                    if (!t||!c) {
                        alert('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                        return;
                    }

                    setLoading(true);
                    try{
                        await apiFetch('/memos',{
                            method: "POST",
                            body: JSON.stringify({
                                title: t,
                                content: c
                            })
                        });

                        //ì…ë ¥ì°½ ì´ˆê¸°í™”
                        setTitle("");
                        setContent("");
                        
                        await loadMemos();

                    } catch (err){
                        console.error(err);
                        alert('ë¦¬ë·° ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    } finally{
                        setLoading(false);
                    }
                }

                return (
                    <div>
                        <h1>ë©”ëª¨ì¥</h1>

                        {/*ë©”ëª¨ ì‘ì„± í¼*/}
                        <h2>ë©”ëª¨ ì‘ì„±</h2>

                        {/*inputì°½ ì•ˆì˜ text*/}
                        <div> 
                            <label>ì œëª©:</label>
                                <input
                                    type = "text"
                                    value = {title}
                                    onChange={e => setTitle(e.target.value)}
                                    placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                                />
                        </div>
                           
                            <div>
                                <label>ë‚´ìš©:</label>
                                <textarea
                                    value={content}
                                    onChange={e => setContent(e.target.value)}
                                    placeholder="ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš”"
                                    rows="4" 
                                />
                            </div> {/*rows : ë‚´ìš© ì…ë ¥ ì°½ì´ ì²˜ìŒì— ë³´ì—¬ì¤„ ì„¸ë¡œì¤„ ìˆ˜*/}

                            <button
                                onClick={addMemo}
                                disabled={loading}
                                style={{backgroundColor: '#4CAF50', color: 'white'}}
                            >
                                {loading ? 'ì¶”ê°€ ì¤‘...': 'ë©”ëª¨ ì¶”ê°€'}
                            </button>
                    

                        <h2>ì „ì²´ ë©”ëª¨ ({memos.length}ê°œ)</h2>
                        
                        {memos.length === 0? (
                            <p> ì•„ì§ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ë©”ëª¨ë¥¼ ì‘ì„±í•´ ë³´ì„¸ìš”!</p>
                        ) : (
                            memos.map(memo => (
                                <div key = {memo.id}
                                className = 'memo-item'>
                                    <h3>{memo.title}</h3>
                                    <p>{memo.content}</p>
                                    <br/>
                                    <button
                                    onClick={()=>deleteMemo(memo.id)}
                                    style= {{backgroundColor: '#f44336', color: 'white'}}

                                    >
                                        ì‚­ì œ
                                    </button>
                                </div>

                            ))

                        )}

                    </div>
                );
            }

                //ë¦¬ì•¡íŠ¸ ì•± ì‹¤í–‰
                const root = ReactDOM.createRoot(document.getElementById('root'));
                root.render(<App/>);
                
        
            </script>
    </head>
    <body>
        <div id = "root"></div>
    </body>
</html>